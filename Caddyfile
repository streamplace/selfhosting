# Global options
{
        # Email for Let's Encrypt
        email youremail@domain.co.uk
}

# Main site - Streamplace server running on host
stream.example.com {
        tls {
             dns cloudflare {env.CLOUDFLARE_API_TOKEN}
        }

        # Handle all routes - Streamplace server on host
        handle {
                reverse_proxy https://host.docker.internal:38443 {
                    # skip TLS certs b/c the Streamplace server serves certs for host domain
                    # may be insecure? revisit eventually
         			transport http {
            				tls_insecure_skip_verify
         			}
      		}
        }

        # Security headers
        header {
                # HSTS - corrected syntax (no semicolon)
                Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
                # Prevent clickjacking
                X-Frame-Options DENY
                # Prevent content type sniffing
                X-Content-Type-Options nosniff
                # XSS protection
                X-XSS-Protection "1; mode=block"
                # Referrer policy
                Referrer-Policy strict-origin-when-cross-origin
                # Permissions policy
                Permissions-Policy "geolocation=(), microphone=(), camera=()"
        }

        # Enable compression
        encode gzip

        # Optional: Add some basic caching headers for static assets
        @static {
                path *.css *.js *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
        }
        header @static Cache-Control "public, max-age=31536000"
}
